function checkEs6(){"use strict";if("undefined"==typeof Symbol)return!1;try{eval("class Foo {}")}catch(e){return!1}return!0}if(checkEs6){var s=document.createElement("script");s.innerHTML="class xCell extends HTMLElement {};window.customElements.define('x-cell', xCell);",document.head.appendChild(s)}function selectText(e){var t,a=document;if(a.body.createTextRange)(t=a.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var o=window.getSelection();(t=a.createRange()).selectNodeContents(e),o.removeAllRanges(),o.addRange(t)}}function updateURL(e,t){var a=window.location.href,o=new RegExp("[?|&]"+e+"=[0-9a-zA-Z_+-|.,;]*");if(o.test(a)){var l=(o=new RegExp("[?&]"+e+"=([^&#]*)")).exec(a)[0].charAt(0);a=a.replace(o,l+e+"="+t)}else{var i=e+"="+t;if(-1===a.indexOf("?")&&(a+="?"),-1<a.indexOf("#")){var s=a.split("#");a=s[0]+"&"+i+(s[1]?"#"+s[1]:"")}else a+="&"+i}window.history.pushState(null,document.title,a)}var _g_tusg_tempScrollTop,activeCell;function getCell(e,t,a){return t=Math.max(0,t),t=Math.min(e.numCols-1,t),a=Math.max(1,a),a=Math.min(e.numRows,a),$(e).find(".c"+t+"r"+a)}function openCell(e,t){var a=$(t).position(),o=$(t).data("formula");$(e.formulaTooltip).css("visibility","visible").css("left",a.left).css("top",a.top).val(o),$(e.formulaTooltip).attr("size",o.length+3).css("min-width",$(t).width()+8),$(t).addClass("open")}function closeCell(e){$(activeCell).removeClass("open"),$(e.formulaTooltip).css("visibility","hidden")}function activateCell(e,t){$(t).addClass("active"),$(e).find("th.r"+($(t).data("row")-1)).addClass("active"),$(e).find("th.c"+$(t).data("col")).addClass("active"),activeCell=t,e.lastPos=[t.data("col"),t.data("row")],$(e.fBar).val($(t).data("formula"))}function deactivateCell(e){$(activeCell).hasClass("open")&&closeCell(e),$(e).find("th.r"+($(activeCell).data("row")-1)).removeClass("active"),$(e).find("th.c"+$(activeCell).data("col")).removeClass("active"),$(activeCell).removeClass("active"),$(this.fBar).val(""),activeCell=null}function moveTo(e,t,a){var o=getCell(e,t,a);o.is(activeCell)||(deactivateCell(e),activateCell(e,o))}$(function(){function o(e){$(e).find(".selectonclick").on("click",function(){selectText(this)})}o("body");var e=$(window),t=$("#topbar");380<$(e).scrollTop()&&$(t).fadeIn(),$(e).scroll(function(){380<$(e).scrollTop()?$(t).fadeIn():$(t).fadeOut()}),$(".form-control").on("change",function(){var e=$(this).attr("name"),t=$(this).val();updateURL(e,_g_tusg_options[e]=t)});var s=$("#os").add("#os-top"),a=$("#software").add("#software-top"),n=$("#version").add("#version-top");$(a).on("change",function(){var e=$(this).val();"Excel for Mac"===e||"NeoOffice"===e?($(s).val("MacOS").attr("disabled",!0),updateURL("os",_g_tusg_options.os="MacOS")):"Excel for Windows"===e?($(s).val("Windows").attr("disabled",!0),updateURL("os",_g_tusg_options.os="Windows")):$(s).attr("disabled",!1);var t=$("#version").val();_g_tusg_options.version=t;var a={"Excel for Windows":["Excel 2016","Excel 2013","Excel 2010","Excel 2007"],"Excel for Mac":["Excel 2016","Excel 2015","Excel 2011","Excel 2008"],"LibreOffice/OpenOffice":["5.0.0","4.4.0","4.3.0","4.2.0","4.1.0","3.6.0"],"Google Sheets":[],NeoOffice:["NeoOffice 2015","NeoOffice 2014","NeoOffice 2013","NeoOffice 3.4"]}[e],o=a.length;-1===a.indexOf(t)&&(t=a[0],updateURL("version",_g_tusg_options.version=t));for(var l="",i=0;i<o;i++)l+="<option",a[i]===t&&(l+=' selected="selected"'),l+=' value="'+a[i]+'">'+a[i]+"</option>";$(n).html(l),"Google Sheets"===e?$(n).attr("disabled",!0):$(n).attr("disabled",!1)}),$("form :input").on("change",function(){var e=$(this).data("pair");$("#"+e).val($(this).val())}),$("form :input").on("change",function(){var e=$(this).closest("form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});_g_tusg_tempScrollTop=$(window).scrollTop(),$.ajax({url:"/content",contentType:"application/json",dataType:"json",type:"POST",processData:!1,data:JSON.stringify(e),success:function(e){for(var t in e){var a=$("section#"+t+" div.body");$(a).fadeOut(75,function(){$(this).html(e[$(this).data("slug")]),o(this)}).fadeIn(130,loadSpreadsheets)}}})})});var loadSpreadsheets=function(e){$(e||this).find(".replaceWithSpreadsheet").each(function(e){var t={key:$(this).data("key"),text:$(this).data("text"),highlight:$(this).data("highlight"),language:_g_tusg_options.language,locale:_g_tusg_options.locale,software:_g_tusg_options.software,version:_g_tusg_options.version,os:_g_tusg_options.os},a=$(this);$.ajax({url:"/spreadsheetAjax",contentType:"application/json",dataType:"json",type:"POST",processData:!1,data:JSON.stringify(t),success:function(e){var t=a.html(e);e&&(activateSpreadsheet(t.find(".spreadsheet")[0]),_g_tusg_tempScrollTop&&$(window).scrollTop(_g_tusg_tempScrollTop))}})})},activateSpreadsheet=function(a){a.numCols=$(a).data("columns"),a.numRows=$(a).data("rows"),a.lastPos=[0,1],a.fBar=$(a).find("input.formula")[0],a.formulaTooltip=$(a).find(".formulaTooltip")[0],$(a).find(".td").each(function(e){var t=this;$(t).on("click touch",function(){return moveTo(a,$(t).data("col"),$(t).data("row")),!0}),$(t).on("dblclick",function(){return openCell(a,t),!1})}),$(a).on("blur",function(){deactivateCell(a)}),$(a).on("focus",function(){moveTo(this,a.lastPos[0],a.lastPos[1])}),$(a).on("keydown",function(e){switch(e.keyCode){case 33:return moveTo(this,$(activeCell).data("col"),1),!1;case 34:return moveTo(this,$(activeCell).data("col"),a.numRows),!1;case 35:return moveTo(this,a.numCols,$(activeCell).data("row")),!1;case 36:return moveTo(this,0,$(activeCell).data("row")),!1;case 37:return moveTo(this,$(activeCell).data("col")-1,$(activeCell).data("row")),!1;case 38:return moveTo(this,$(activeCell).data("col"),$(activeCell).data("row")-1),!1;case 39:return moveTo(this,$(activeCell).data("col")+1,$(activeCell).data("row")),!1;case 40:return moveTo(this,$(activeCell).data("col"),$(activeCell).data("row")+1),!1;case 27:return $(activeCell).hasClass("open")?closeCell(this):$(this).blur(),!1;case 113:case 13:$(activeCell).hasClass("open")||openCell(this,activeCell)}})};$(document).ready(function(){loadSpreadsheets($(document))});