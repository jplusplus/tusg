function selectText(e){var t,a=document;if(a.body.createTextRange)t=a.body.createTextRange(),t.moveToElementText(e),t.select();else if(window.getSelection){var o=window.getSelection();t=a.createRange(),t.selectNodeContents(e),o.removeAllRanges(),o.addRange(t)}}function moveTo(e,t,a){t=Math.max(0,t),t=Math.min(e.numCols-1,t),a=Math.max(1,a),a=Math.min(e.numRows,a),$(activeCell).removeClass("active");var o=$(e).find(".c"+t+"r"+a);$(o).addClass("active"),activeCell=o,e.lastPos=[o.data("col"),o.data("row")],$(e).find("input").val($(o).data("formula"))}$(function(){function e(e){$(e).find(".selectonclick").on("click",function(){selectText(this)})}e("body");var t=$(window),a=$("#topbar");$(t).scrollTop()>380&&$(a).fadeIn(),$(t).scroll(function(){$(t).scrollTop()>380?$(a).fadeIn():$(a).fadeOut()});var o=$("#os").add("#os-top"),n=$("#software").add("#software-top"),s=$("#version").add("#version-top"),i=$("#language").add("#language-top");$(i).on("change",function(){_g_tusg_options.language=$(this).val()});var c=$("#locale").add("#locale-top");$(c).on("change",function(){_g_tusg_options.locale=$(this).val()}),$(n).on("change",function(){var e=$(this).val();_g_tusg_options.software=e,"Excel for Mac"===e||"NeoOffice"===e?($(o).val("MacOS").attr("disabled",!0),_g_tusg_options.os="MacOS"):"Excel for Windows"===e?($(o).val("Windows").attr("disabled",!0),_g_tusg_options.os="Windows"):$(o).attr("disabled",!1);var t=$("#version").val();_g_tusg_options.version=t;var a={"Excel for Windows":["Excel 2016","Excel 2013","Excel 2010","Excel 2007"],"Excel for Mac":["Excel 2016","Excel 2015","Excel 2011","Excel 2008"],"LibreOffice/OpenOffice":["5.0.0","4.4.0","4.3.0","4.2.0","4.1.0","3.6.0"],"Google Sheets":[],NeoOffice:["NeoOffice 2015","NeoOffice 2014","NeoOffice 2013","NeoOffice 3.4"]}[e],n=a.length;a.indexOf(t)===-1&&(t=a[0],_g_tusg_options.version=t);for(var i="",c=0;c<n;c++)i+="<option",a[c]===t&&(i+=' selected="selected"'),i+=' value="'+a[c]+'">'+a[c]+"</option>";$(s).html(i),"Google Sheets"===e?$(s).attr("disabled",!0):$(s).attr("disabled",!1)}),$("form :input").on("change",function(){var e=$(this).data("pair");$("#"+e).val($(this).val())}),$("form :input").on("change",function(){var t=$(this).closest("form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});$.ajax({url:"/content",contentType:"application/json",dataType:"json",type:"POST",processData:!1,data:JSON.stringify(t),success:function(t){for(var a in t){var o=$("section#"+a+" div.body");$(o).fadeOut(75,function(){$(this).html(t[$(this).data("slug")]),e(this)}).fadeIn(150)}var n=setTimeout(function(){loadSpreadsheets(),clearTimeout(n)},900)}})})});var activeCell,loadSpreadsheets=function(){$(".replaceWithSpreadsheet").each(function(e){var t={key:$(this).data("key"),text:$(this).data("text"),language:_g_tusg_options.language,locale:_g_tusg_options.locale,software:_g_tusg_options.software},a=$(this);$.ajax({url:"/spreadsheetAjax",contentType:"application/json",dataType:"json",type:"POST",processData:!1,data:JSON.stringify(t),success:function(e){var t=a.html(e);e&&activateSpreadsheet(t.find(".spreadsheet")[0])}})})},activateSpreadsheet=function(e){var e=e;e.numCols=$(e).data("columns"),e.numRows=$(e).data("rows"),e.lastPos=[0,1];var t=$(e).find("input");$(e).find("td").each(function(t){var a=this;$(a).on("click touch",function(){moveTo(e,$(a).data("col"),$(a).data("row"))})}),$(e).on("blur",function(){$("td.active").removeClass("active"),$(t).val(""),activeCell=null}),$(e).on("focus",function(){moveTo(this,e.lastPos[0],e.lastPos[1])}),$(e).on("keydown",function(t){switch(t.keyCode){case 33:return moveTo(this,$(activeCell).data("col"),1),!1;case 34:return moveTo(this,$(activeCell).data("col"),e.numRows),!1;case 35:return moveTo(this,e.numCols,$(activeCell).data("row")),!1;case 36:return moveTo(this,0,$(activeCell).data("row")),!1;case 37:return moveTo(this,$(activeCell).data("col")-1,$(activeCell).data("row")),!1;case 38:return moveTo(this,$(activeCell).data("col"),$(activeCell).data("row")-1),!1;case 39:return moveTo(this,$(activeCell).data("col")+1,$(activeCell).data("row")),!1;case 40:return moveTo(this,$(activeCell).data("col"),$(activeCell).data("row")+1),!1;case 27:return $(this).blur(),!1}})};$(document).ready(function(){loadSpreadsheets()});